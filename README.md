# 📊 期货持仓分析系统 v4.0

<div align="center">

**基于在线数据的智能期货持仓分析系统**

[![Streamlit App](https://static.streamlit.io/badges/streamlit_badge_black_white.svg)](https://futuresyes.streamlit.app/)
[![Python](https://img.shields.io/badge/Python-3.9+-blue.svg)](https://www.python.org/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

[在线体验](https://futuresyes.streamlit.app/) | [功能特点](#-功能特点) | [快速开始](#-快速开始) | [更新日志](#-更新日志)

</div>

---

## 🎯 核心亮点


- **🌐 在线基差数据获取**：实时调用 API 获取基差数据，准确识别主力合约
- **📈 52个品种全覆盖**：涵盖大商所、郑商所、上期所、广期所52个活跃品种
- **🎯 94%+ 成功率**：基于准确的主力合约，数据获取成功率高达94%
- **⚡ 完全自动化**：零维护成本，数据总是最新的

### 🔥 系统特色

| 特性 | 说明 | 优势 |
|-----|------|------|
| **在线模式** | 实时获取基差数据 | 准确识别主力合约，成功率94%+ |
| **多策略分析** | 5大核心策略 | 多空力量、蜘蛛网、家人席位、期限结构、信号共振 |
| **智能缓存** | 避免重复分析 | 相同日期秒级响应 |
| **实时可视化** | Plotly交互图表 | 直观展示分析结果 |
| **自定义配置** | 灵活配置家人席位 | 适应不同分析需求 |

---

## 📋 功能特点

### 1. 🔄 多空力量变化策略

通过分析席位持仓的增减变化，判断市场趋势：

- ✅ 多单增加 + 空单减少 → 看多信号
- ✅ 空单增加 + 多单减少 → 看空信号
- ✅ 成交量配合验证
- ✅ 量价配合分析

**适用场景**：趋势判断、入场时机选择

### 2. 🕸️ 蜘蛛网策略

基于持仓分布的分化程度，判断机构资金参与情况：

- 📊 计算持仓分布标准差
- 🎯 识别主力资金动向
- ⚖️ 评估市场分歧度
- 🔍 发现异常持仓变化

**适用场景**：主力资金追踪、市场情绪判断

### 3. 👥 家人席位反向操作策略

基于散户投资者行为特点的反向策略：

- 🔄 监控散户集中的期货公司席位
- ⚠️ 识别散户集中做多/做空的品种
- 💡 反向操作信号生成
- 📈 历史验证成功率高

**默认家人席位**：东方财富、平安期货、徽商期货（可自定义）

**适用场景**：反向交易、风险规避

### 4. 📊 期限结构分析

分析同品种不同月份合约的价格关系：

- 📈 识别升水/贴水结构
- 🔄 跨期套利机会发现
- 📅 主力合约切换判断
- ⏰ 交割月效应分析

**适用场景**：套利交易、交割决策

### 5. 🎯 信号共振分析

识别多策略共同看好的品种：

- ⚡ 多策略信号叠加
- 🎯 高置信度品种筛选
- 📊 共振强度评分
- 🔝 优先级排序

**适用场景**：重点品种筛选、仓位配置

---

## 🚀 快速开始

### 在线使用（推荐）

**无需安装，直接访问** → [https://futuresyes.streamlit.app/](https://futuresyes.streamlit.app/)

### 本地部署

#### 1. 环境要求

- Python 3.9+
- 稳定的网络连接

#### 2. 克隆项目

```bash
git clone https://github.com/haoge10241024/futures_position_analysis.git
cd futures_position_analysis
```

#### 3. 安装依赖

```bash
pip install -r requirements.txt
```

#### 4. 运行应用

```bash
streamlit run streamlit_app.py
```

#### 5. 访问应用

在浏览器打开：`http://localhost:8501`

---

## 📖 使用指南

### 基本使用

1. **选择日期**：在侧边栏选择要分析的交易日期
2. **配置席位**：自定义家人席位（可选）
3. **开始分析**：点击"🚀 开始分析"按钮
4. **查看结果**：通过标签页查看不同策略的分析结果

### 高级功能

#### 自定义家人席位

```python
# 在侧边栏"家人席位配置"中：
# 1. 输入席位名称（如："方正中期"）
# 2. 点击"添加席位"
# 3. 可删除不需要的席位
```

#### 数据刷新

- 系统自动缓存分析结果
- 相同日期和配置使用缓存（秒级响应）
- 点击"🗑️ 清除缓存"强制重新分析

#### 结果导出

- 所有表格支持复制粘贴
- 图表支持导出为PNG/SVG
- 详细数据可在"📋 详细数据"标签查看

---

## 🔬 技术架构

### 核心技术栈

```
Frontend: Streamlit 1.32.2
Data Source: AkShare 1.15.0
Visualization: Plotly 5.19.0
Data Processing: Pandas 2.2.1, NumPy 1.26.4
```

### 数据流程

```
用户选择日期
    ↓
【步骤1】在线获取基差数据（ak.futures_spot_price）
    ↓
提取52个品种的主力合约（dominant_contract）
    ↓
【步骤2】遍历各交易所品种
    ↓
使用准确的主力合约获取持仓数据（ak.futures_hold_pos_sina）
    ↓
【步骤3】执行5大分析策略
    ↓
生成分析结果和可视化图表
    ↓
展示给用户
```

### 关键优化

| 优化项 | 技术 | 效果 |
|--------|------|------|
| 主力合约识别 | 在线基差API | 准确率从50%提升至94% |
| 数据缓存 | st.session_state | 相同日期秒级响应 |
| 数据获取 | 异步请求 + 超时控制 | 稳定性提升 |
| 可视化 | Plotly交互图表 | 用户体验优化 |

---

## 📊 支持的品种

### 大商所（16个品种）

豆一(A)、玉米(C)、豆粕(M)、豆油(Y)、棕榈油(P)、铁矿石(I)、焦煤(JM)、鸡蛋(JD)、聚乙烯(L)、聚丙烯(PP)、PVC(V)、苯乙烯(EB)、乙二醇(EG)、液化石油气(PG)、生猪(LH)、氧化铝(BZ)

### 郑商所（17个品种）

棉花(CF)、棉纱(CY)、玻璃(FG)、甲醇(MA)、菜籽油(OI)、菜籽粕(RM)、纯碱(SA)、硅铁(SF)、锰硅(SM)、白糖(SR)、PTA(TA)、尿素(UR)、短纤(PF)、对二甲苯(PX)、瓶片(PR)、烧碱(SH)、线材(WR)

### 上期所（16个品种）

沪铝(AL)、黄金(AU)、白银(AG)、沥青(BU)、沪铜(CU)、燃油(FU)、热卷(HC)、镍(NI)、铅(PB)、螺纹钢(RB)、天然橡胶(RU)、锡(SN)、纸浆(SP)、不锈钢(SS)、锌(ZN)、丁二烯橡胶(BR)

### 广期所（3个品种）

碳酸锂(LC)、工业硅(SI)、多晶硅(PS)

**总计：52个活跃品种** ✅

---

## 📈 数据说明

### 数据来源

- **基差数据**：AkShare - `ak.futures_spot_price()` 
- **持仓数据**：AkShare - `ak.futures_hold_pos_sina()`
- **更新频率**：实时获取，每次分析都是最新数据

### 数据时效性

- 基差数据：T日收盘后更新
- 持仓数据：T日收盘后更新
- 建议分析时间：T+1日开盘前

### 数据准确性

- ✅ 主力合约：从基差API直接读取（最准确）
- ✅ 持仓数据：新浪财经官方接口（权威数据）
- ✅ 数据覆盖：52个品种，94%成功率

---

## 🔧 配置说明

### 家人席位配置

默认家人席位：
```python
DEFAULT_RETAIL_SEATS = [
    "东方财富",
    "平安期货", 
    "徽商期货"
]
```

可在侧边栏自定义添加/删除席位。

### 策略参数配置

在 `config.py` 中可配置：

```python
STRATEGY_CONFIG = {
    "force_change": {
        "threshold": 0.7,  # 力量变化阈值
        "volume_multiplier": 1.2  # 成交量倍数
    },
    "spider_web": {
        "long_threshold": 80000,  # 多单标准差阈值
        "short_threshold": 80000   # 空单标准差阈值
    },
    "retail_reverse": {
        "min_concentration": 0.15  # 最小集中度
    }
}
```

---

## 📱 移动端支持

系统完全支持移动端访问：

- ✅ 响应式布局
- ✅ 触摸操作优化
- ✅ 图表自适应
- ✅ 侧边栏移动端友好

---

## ⚡ 性能指标

| 指标 | 数值 | 说明 |
|------|------|------|
| 数据获取时间 | 40-60秒 | 52个品种持仓数据 |
| 基差获取时间 | 3-5秒 | 一次性获取所有品种 |
| 分析计算时间 | 5-10秒 | 5大策略并行分析 |
| 缓存响应时间 | <1秒 | 相同日期和配置 |
| **总耗时** | **50-80秒** | **完整分析流程** |

---

## 🐛 常见问题

### Q: 数据获取失败怎么办？

**A**: 
1. 检查网络连接
2. 确认选择的是交易日（非周末/节假日）
3. 避免在交易时间获取（可能数据未更新）
4. 清除缓存后重试

### Q: 某些品种没有数据？

**A**: 
- 部分品种可能当天无持仓数据
- 新上市品种可能数据覆盖不全
- 系统已自动跳过，不影响其他品种分析

### Q: 如何提高分析速度？

**A**:
1. 使用缓存功能（相同日期秒级响应）
2. 避免频繁切换日期
3. 部署在本地可获得更快速度

### Q: 家人席位如何选择？

**A**:
- 默认席位基于公开信息和历史表现
- 可根据实际情况自定义
- 建议选择3-5个散户集中的席位

---


## 👨‍💻 作者信息

**作者**：7haoge  
**邮箱**：953534947@qq.com  
**项目**：[GitHub](https://github.com/haoge10241024/futures_position_analysis)  
**在线**：[Streamlit App](https://futuresyes.streamlit.app/)

---

## 📄 开源协议

本项目采用 [MIT License](LICENSE) 开源协议。

---

## 🙏 致谢

- [Streamlit](https://streamlit.io/) - 优秀的Web应用框架
- [AkShare](https://github.com/akfamily/akshare) - 免费的金融数据接口
- [Plotly](https://plotly.com/) - 强大的可视化库

---

## 💬 反馈与支持

- 🐛 **Bug报告**：[GitHub Issues](https://github.com/haoge10241024/futures_position_analysis/issues)
- 💡 **功能建议**：[GitHub Discussions](https://github.com/haoge10241024/futures_position_analysis/discussions)
- 📧 **邮件联系**：953534947@qq.com

---

<div align="center">

**⭐ 如果这个项目对您有帮助，请给个Star支持一下！**

[⬆ 返回顶部](#-期货持仓分析系统-v40)

</div>
